<html>
<head>
<title>RuntimeParameters.cpp</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #999999; font-weight: normal; font-style: normal; }
.s0 { color: rgb(128,128,128); font-style: italic; }
.s1 { color: rgb(0,0,0); }
.s2 { color: rgb(128,128,0); }
.s3 { color: rgb(0,128,0); font-weight: bold; }
.s4 { color: rgb(0,0,128); font-weight: bold; }
.s5 { color: rgb(0,0,255); }
</style>
</head>
<BODY BGCOLOR="#ffffff">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#c0c0c0" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
RuntimeParameters.cpp</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">//</span><span class="s1"> 
</span><span class="s0">// Created by Malachi Phillips on 9/25/16.</span><span class="s1"> 
</span><span class="s0">//</span><span class="s1"> 
 
</span><span class="s0">// C++: where friends can access your private members!</span><span class="s1"> 
 
</span><span class="s2">#include</span><span class="s3"> &quot;RuntimeParameters.h&quot;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;iostream&gt;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;fstream&gt;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;string&gt;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;vector&gt;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;sstream&gt;</span><span class="s1"> 
</span><span class="s2">#include</span><span class="s3"> &lt;math.h&gt;</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s0">/* 
 * Factory function for creating runtime parameter handler 
 */</span><span class="s1"> 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s0">//RuntimeParameters* RuntimeParameters::create_runtime_param(std::string &amp;whichPDE) {</span><span class="s1"> 
</span><span class="s0">//    if (whichPDE == &quot;LinearWaveEquation&quot;){</span><span class="s1"> 
</span><span class="s0">//        return new RuntimeParametersLinWave;</span><span class="s1"> 
</span><span class="s0">//    }</span><span class="s1"> 
</span><span class="s0">//</span><span class="s1"> 
</span><span class="s0">//    if (whichPDE == &quot;DiffusionEquation&quot;){</span><span class="s1"> 
</span><span class="s0">//        return new RuntimeParametersDiffusion;</span><span class="s1"> 
</span><span class="s0">//    }</span><span class="s1"> 
</span><span class="s0">//</span><span class="s1"> 
</span><span class="s0">//    else{</span><span class="s1"> 
</span><span class="s0">//        // Should never reach here -- this was already checked!</span><span class="s1"> 
</span><span class="s0">//        return NULL;</span><span class="s1"> 
</span><span class="s0">//    }</span><span class="s1"> 
</span><span class="s0">//}</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s0">/* 
 * Runtime parameter handler for linear wave equation 
 */</span><span class="s1"> 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersLinWave::read_parameters_from_file(std::string&amp; runtime_file){ 
 
 
    </span><span class="s0">/* 
     * Read in runtime parameters. 
     * Current method: user specifies the length of the wave in from of endpoints, xo and xf 
     * User specifies begin time (let's say, to, although this is arbitrary) 
     * User specifies number of time points 
     * User specifies step size for time 
     * From CFL (or safetyFactory * CFL), the step size is inferred 
     */</span><span class="s1"> 
 
    </span><span class="s0">// Read and set parameters from file --  pass in order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * num t steps 
     * dt 
     * xo 
     * xf 
     * c 
     * value at LHS wall 
     * 
     */</span><span class="s1"> 
    std::ifstream myInputFile; 
    myInputFile.open(runtime_file); 
    </span><span class="s4">if </span><span class="s1">(!myInputFile.is_open()){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: cannot open file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; std::endl; 
        std::cout &lt;&lt; </span><span class="s3">&quot;Please ensure that the file name was properly entered.&quot;</span><span class="s1">; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
    std::string currentLine; 
    std::vector&lt;</span><span class="s4">double</span><span class="s1">&gt; inputParameters; 
    </span><span class="s0">// iterate over lines of file</span><span class="s1"> 
    </span><span class="s4">while</span><span class="s1">(std::getline(myInputFile,currentLine)){ 
        </span><span class="s0">// string to double conversion</span><span class="s1"> 
        </span><span class="s4">double </span><span class="s1">valueFromFile = std::stod(currentLine); 
 
        </span><span class="s0">// write current value to holder</span><span class="s1"> 
        inputParameters.push_back(valueFromFile); 
    } 
 
    </span><span class="s0">// Check that size of input parameters is correct -- 8</span><span class="s1"> 
    </span><span class="s4">if </span><span class="s1">(inputParameters.size() != </span><span class="s5">8</span><span class="s1">){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: number of inputs in file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; </span><span class="s3">&quot; is not 8&quot; </span><span class="s1">&lt;&lt; std::endl; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
 
    </span><span class="s0">// In order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * num time steps 
     * dt 
     * xo 
     * xf 
     * c 
     * value at LHS of wall 
     * CFL 
     * 
     */</span><span class="s1"> 
 
    set_to(inputParameters[</span><span class="s5">0</span><span class="s1">]); 
    set_time_iterations((</span><span class="s4">unsigned int</span><span class="s1">)inputParameters[</span><span class="s5">1</span><span class="s1">]); 
    set_dt(inputParameters[</span><span class="s5">2</span><span class="s1">]); 
    set_xo(inputParameters[</span><span class="s5">3</span><span class="s1">]); 
    set_xf(inputParameters[</span><span class="s5">4</span><span class="s1">]); 
    set_c(inputParameters[</span><span class="s5">5</span><span class="s1">]); 
    set_wall_boundary(inputParameters[</span><span class="s5">6</span><span class="s1">]); 
    set_CFL(inputParameters[</span><span class="s5">7</span><span class="s1">]); 
 
    </span><span class="s0">// calculate important parameters from user specified</span><span class="s1"> 
    </span><span class="s0">//set_CFL();</span><span class="s1"> 
    set_space_iterations(); 
 
 
    </span><span class="s0">//TODO: error trapping for inputs, ie. make sure that time does not reverse, etc.</span><span class="s1"> 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersLinWave::set_CFL(){ 
    </span><span class="s0">// For constant c ie. ut + cux = 0</span><span class="s1"> 
    </span><span class="s0">// Exact solution is obtained for CFL of 1</span><span class="s1"> 
    </span><span class="s0">// Ergo, force CFL to be 1 for this case, regardless of</span><span class="s1"> 
    </span><span class="s0">// user entry</span><span class="s1"> 
 
    CFL_ = </span><span class="s5">1.0</span><span class="s1">; 
 
    </span><span class="s0">// warn user of this decision</span><span class="s1"> 
    std::cout &lt;&lt; </span><span class="s3">&quot;CFL of: &quot; </span><span class="s1">&lt;&lt; CFL_ &lt;&lt; </span><span class="s3">&quot; is being used.&quot; </span><span class="s1">&lt;&lt; std::endl; 
    std::cout &lt;&lt; </span><span class="s3">&quot;For constant c, ut + cux = 0, CFL of 1 gives exact solution&quot; </span><span class="s1">&lt;&lt; std::endl; 
 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersLinWave::set_space_iterations(){ 
 
    </span><span class="s0">// will calculate needed dx to ensure CFL is unity</span><span class="s1"> 
    dx_ = c_*dt_/CFL_; 
    space_iterations_ = (</span><span class="s4">int</span><span class="s1">)((xf_-xo_)/dx_); </span><span class="s0">// not sure if floor or ceiling - needs to be ceiling</span><span class="s1"> 
    </span><span class="s0">// Check this</span><span class="s1"> 
 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s0">/* 
 * Runtime parameter handler for diffusion PDE 
 */</span><span class="s1"> 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersDiffusion::read_parameters_from_file(std::string&amp; runtime_file){ 
 
 
    </span><span class="s0">/* 
     * Read in runtime parameters. 
     * For diffusion equation: 
     * User picks to, tf, xo, xf, dx, v, value at LHS wall, safety factor 
     * dt is picked from the stability analysis and safety factor 
     * 
     */</span><span class="s1"> 
 
    </span><span class="s0">// Read and set parameters from file --  pass in order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * tf 
     * xo 
     * xf 
     * dx 
     * v 
     * value at LHS wall 
     * value at RHS wall 
     * safety factor 
     */</span><span class="s1"> 
    std::ifstream myInputFile; 
    myInputFile.open(runtime_file); 
    </span><span class="s4">if </span><span class="s1">(!myInputFile.is_open()){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: cannot open file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; std::endl; 
        std::cout &lt;&lt; </span><span class="s3">&quot;Please ensure that the file name was properly entered.&quot;</span><span class="s1">; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
    std::string currentLine; 
    std::vector&lt;</span><span class="s4">double</span><span class="s1">&gt; inputParameters; 
    </span><span class="s0">// iterate over lines of file</span><span class="s1"> 
    </span><span class="s4">while</span><span class="s1">(std::getline(myInputFile,currentLine)){ 
        </span><span class="s0">// string to double conversion</span><span class="s1"> 
        </span><span class="s4">double </span><span class="s1">valueFromFile = std::stod(currentLine); 
 
        </span><span class="s0">// write current value to holder</span><span class="s1"> 
        inputParameters.push_back(valueFromFile); 
    } 
 
    </span><span class="s0">// Check that size of input parameters is correct -- 9</span><span class="s1"> 
    </span><span class="s4">if </span><span class="s1">(inputParameters.size() != </span><span class="s5">9</span><span class="s1">){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: number of inputs in file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; </span><span class="s3">&quot; is not 9&quot; </span><span class="s1">&lt;&lt; std::endl; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
 
    </span><span class="s0">// In order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * number iterations 
     * xo 
     * xf 
     * dx 
     * v 
     * value at LHS wall 
     * value at RHS wall 
     * safety factor 
     */</span><span class="s1"> 
 
    set_to(inputParameters[</span><span class="s5">0</span><span class="s1">]); 
    set_time_iterations(inputParameters[</span><span class="s5">1</span><span class="s1">]); 
    set_xo(inputParameters[</span><span class="s5">2</span><span class="s1">]); 
    set_xf(inputParameters[</span><span class="s5">3</span><span class="s1">]); 
    set_dx(inputParameters[</span><span class="s5">4</span><span class="s1">]); 
    set_nu(inputParameters[</span><span class="s5">5</span><span class="s1">]); 
    add_wall_value(inputParameters[</span><span class="s5">6</span><span class="s1">]); 
    add_wall_value(inputParameters[</span><span class="s5">7</span><span class="s1">]); 
    set_safety_factor(inputParameters[</span><span class="s5">8</span><span class="s1">]); 
 
    </span><span class="s0">// calculate important parameters from user specified</span><span class="s1"> 
    set_dt(); 
    set_space_iterations(); 
 
    set_alpha(); 
 
    </span><span class="s0">//TODO: error trapping for inputs, ie. make sure that time does not reverse, etc.</span><span class="s1"> 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersDiffusion::set_space_iterations(){ 
    space_iterations_ = (</span><span class="s4">int</span><span class="s1">)((xf_-xo_)/dx_); </span><span class="s0">// not sure if floor or ceiling - needs to be ceiling</span><span class="s1"> 
    </span><span class="s0">// Check this</span><span class="s1"> 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersDiffusion::set_dt(){ 
    dt_ = </span><span class="s5">0.5 </span><span class="s1">* safetyFactor_ * dx_ * dx_ / nu_; 
} 
 
</span><span class="s0">////============================================================================================================</span><span class="s1"> 
</span><span class="s0">//void RuntimeParametersDiffusion::set_time_iterations(){</span><span class="s1"> 
</span><span class="s0">//    space_iterations_ = (int)(ceil(((tf_-to_)/dt_)));</span><span class="s1"> 
</span><span class="s0">//}</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersDiffusion::set_alpha(){ 
    alpha_ = nu_ * dt_ / dx_ / dx_; 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersDiffusion::set_wall_boundary(std::vector&lt;</span><span class="s4">double</span><span class="s1">&gt;&amp; wallVals){ 
    </span><span class="s4">for</span><span class="s1">(</span><span class="s4">unsigned int </span><span class="s1">i = </span><span class="s5">0 </span><span class="s1">; i &lt; wallVals.size(); ++i){ 
        wallValues_[i] = wallVals[i]; 
    } 
} 
 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s0">/* 
 * Runtime parameter handler for Burger PDE 
 */</span><span class="s1"> 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersBurger::read_parameters_from_file(std::string&amp; runtime_file){ 
 
 
    </span><span class="s0">/* 
     * Read in runtime parameters. 
     * For diffusion equation: 
     * User picks to, tf, xo, xf, dx, v, value at LHS wall, safety factor 
     * dt is picked from the stability analysis and safety factor 
     * 
     */</span><span class="s1"> 
 
    </span><span class="s0">// Read and set parameters from file --  pass in order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * tf 
     * xo 
     * xf 
     * dx 
     * v 
     * value at LHS wall 
     * value at RHS wall 
     * safety factor 
     */</span><span class="s1"> 
    std::ifstream myInputFile; 
    myInputFile.open(runtime_file); 
    </span><span class="s4">if </span><span class="s1">(!myInputFile.is_open()){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: cannot open file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; std::endl; 
        std::cout &lt;&lt; </span><span class="s3">&quot;Please ensure that the file name was properly entered.&quot;</span><span class="s1">; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
    std::string currentLine; 
    std::vector&lt;</span><span class="s4">double</span><span class="s1">&gt; inputParameters; 
    </span><span class="s0">// iterate over lines of file</span><span class="s1"> 
    </span><span class="s4">while</span><span class="s1">(std::getline(myInputFile,currentLine)){ 
        </span><span class="s0">// string to double conversion</span><span class="s1"> 
        </span><span class="s4">double </span><span class="s1">valueFromFile = std::stod(currentLine); 
 
        </span><span class="s0">// write current value to holder</span><span class="s1"> 
        inputParameters.push_back(valueFromFile); 
    } 
 
    </span><span class="s0">// Check that size of input parameters is correct -- 10</span><span class="s1"> 
    </span><span class="s4">if </span><span class="s1">(inputParameters.size() != </span><span class="s5">10</span><span class="s1">){ 
        std::cout &lt;&lt; </span><span class="s3">&quot;Error: number of inputs in file &quot; </span><span class="s1">&lt;&lt; runtime_file &lt;&lt; </span><span class="s3">&quot; is not 10&quot; </span><span class="s1">&lt;&lt; std::endl; 
        </span><span class="s0">// should throw runtime error here</span><span class="s1"> 
    } 
 
    </span><span class="s0">// In order of</span><span class="s1"> 
    </span><span class="s0">/* 
     * to 
     * number iterations, time 
     * xo 
     * xf 
     * dx 
     * v 
     * umax 
     * value at LHS wall 
     * value at RHS wall 
     * safety factor 
     */</span><span class="s1"> 
 
    set_to(inputParameters[</span><span class="s5">0</span><span class="s1">]); 
    set_time_iterations(inputParameters[</span><span class="s5">1</span><span class="s1">]); 
    set_xo(inputParameters[</span><span class="s5">2</span><span class="s1">]); 
    set_xf(inputParameters[</span><span class="s5">3</span><span class="s1">]); 
    set_dx(inputParameters[</span><span class="s5">4</span><span class="s1">]); 
    set_nu(inputParameters[</span><span class="s5">5</span><span class="s1">]); 
    set_cmax(inputParameters[</span><span class="s5">6</span><span class="s1">]); 
    add_wall_value(inputParameters[</span><span class="s5">7</span><span class="s1">]); 
    add_wall_value(inputParameters[</span><span class="s5">8</span><span class="s1">]); 
    set_safety_factor(inputParameters[</span><span class="s5">9</span><span class="s1">]); 
 
    </span><span class="s0">// calculate important parameters from user specified</span><span class="s1"> 
    set_dt(); 
    set_space_iterations(); 
 
    set_alpha(); 
 
    </span><span class="s0">//TODO: error trapping for inputs, ie. make sure that time does not reverse, etc.</span><span class="s1"> 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersBurger::set_space_iterations(){ 
    space_iterations_ = (</span><span class="s4">int</span><span class="s1">)((xf_-xo_)/dx_); </span><span class="s0">// not sure if floor or ceiling - needs to be ceiling</span><span class="s1"> 
    </span><span class="s0">// Check this</span><span class="s1"> 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersBurger::set_dt(){ 
    dt_ = </span><span class="s5">0.5 </span><span class="s1">* safetyFactor_ * dx_ * dx_ / nu_; 
} 
 
</span><span class="s0">////============================================================================================================</span><span class="s1"> 
</span><span class="s0">//void RuntimeParametersDiffusion::set_time_iterations(){</span><span class="s1"> 
</span><span class="s0">//    space_iterations_ = (int)(ceil(((tf_-to_)/dt_)));</span><span class="s1"> 
</span><span class="s0">//}</span><span class="s1"> 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersBurger::set_alpha(){ 
    alpha_ = nu_ * dt_ / dx_ / dx_; 
} 
 
</span><span class="s0">//============================================================================================================</span><span class="s1"> 
</span><span class="s4">void </span><span class="s1">RuntimeParametersBurger::set_wall_boundary(std::vector&lt;</span><span class="s4">double</span><span class="s1">&gt;&amp; wallVals){ 
    </span><span class="s4">for</span><span class="s1">(</span><span class="s4">unsigned int </span><span class="s1">i = </span><span class="s5">0 </span><span class="s1">; i &lt; wallVals.size(); ++i){ 
        wallValues_[i] = wallVals[i]; 
    } 
}</span></pre>
</body>
</html>